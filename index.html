<html>
<head>
<title>Score Maker</title>
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<script>
    function setPreview(data) {
        const preview = document.querySelector('.preview');
        preview.src = "data:image/png;base64," + data;
    }

    function doPreview() {
        const body = document.querySelector('textarea[name="body"]');
        
        fetch('/preview', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                body: body.value,
            }),
        })
        .then(response => response.text())
        .then(data => {
            console.log(data);
            setPreview(data);
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        doPreview();

        const autoUpdate = document.getElementById('auto-update');
        const body = document.querySelector('textarea[name="body"]');
        autoUpdate.addEventListener('change', function() {
            if (autoUpdate.checked) {
                let timeout;
                body.addEventListener('input', function() {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        doPreview();
                    }, 200);
                });
            } else {
                body.removeEventListener('input', function() {});
            }
        });
    });
</script>
</head>
<body class="p-4">
    <article class="prose lg:prose-xl">
        <h1>Score Maker</h1>
    </article>
    <div class="text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:text-gray-400 dark:border-gray-700">
        <ul class="flex flex-wrap -mb-px">
            <li class="me-2">
                <a href="/" class="inline-block p-4 text-blue-600 border-b-2 border-blue-600 rounded-t-lg active dark:text-blue-500 dark:border-blue-500" aria-current="page">Accueil</a>
            </li>
            <li class="me-2">
                <a href="/help" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300">Aide</a>
            </li>
            <li class="me-2">
                <a href="/examples" class="inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300">Exemples</a>
            </li>
            <li>
                <a class="inline-block p-4 text-gray-400 rounded-t-lg cursor-not-allowed dark:text-gray-500">Configuration (à venir)</a>
            </li>
        </ul>
    </div>
    <div class="my-2 p-2 bg-red-100 text-red-800">
        <b>Attention</b> : une erreur dans le code peut mener à une partition qui s'arrête de façon abrupte.
    </div>
    <div class="lg:grid grid-cols-2">
        <div class="bg-gray-100 p-4 m-2">
            <form class="">
            <!-- <form method="post" action="/draw" class="bg-gray-100 p-4 m-2"> -->
                <textarea name="body" rows="22"
                class="w-full bg-white text-gray-800 py-1 px-2 border border-gray-400 rounded shadow"
                >{% if loaded %}{{ loaded }}{% else %}BEGIN line
SET duration 2 /* 0 = ronde, 1 = blanche, 2 = noire, etc. */
1 2 3 4 | 5 6 7 8 |{% endif %}</textarea>
                <br/>
                <br/>
                <label class="mr-4"><input type="checkbox" id="auto-update" class="mr-2">Prévisualisation automatique</label>
                <input type="button" onclick="doPreview();" value="Valider" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">
            </form>
        </div>
        <div class="border p-4 m-2 shadow">
            <img class="preview" src="" alt="" class="max-w-full">
        </div>
    </div>
</body>
</html>